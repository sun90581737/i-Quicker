@{
    ViewBag.Title = "经营概览/交付率/进度";
    Layout = "~/Views/Shared/_Index.cshtml";
}

<script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
<script src="~/Content/js/bootstrap/bootstrap.js"></script>
<link href="~/Content/js/bootstrap/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/js/pages/AdminLTE.css" rel="stylesheet" />
<link href="~/Content/js/pages/AdminLTE.min.css" rel="stylesheet" />
<style>
    /*https://www.jb51.net/css/27189.html*/
    .process-bar {
        width: 100px;
        display: inline-block;
        *zoom: 1;
    }

    .pb-wrapper {
        border: 1px solid gray;
        border-style: solid none;
        position: relative;
        background: #cfd0d2;
    }

    .pb-container {
        border: 1px solid gray;
        border-style: none solid;
        height: 12px;
        position: relative;
        left: -1px;
        margin-right: -2px;
        font: 1px/0 arial;
        padding: 1px;
    }

    .pb-highlight {
        position: absolute;
        left: 0;
        top: 0;
        _top: 1px;
        width: 100%;
        opacity: 0.6;
        filter: alpha(opacity=60);
        height: 6px;
        background: white;
        font-size: 1px;
        line-height: 0;
        z-index: 1;
    }

    .pb-text {
        width: 100%;
        position: absolute;
        left: 0;
        top: 0;
        text-align: center;
        font: 10px/12px arial;
    }

    .pb-text {
        color: black;
        font: 10px/12px arial;
    }
    /* -- 以下是重写的皮肤 -- */ /* green */

    .skin-green .pb-wrapper {
        border-color: #666;
        border-top-color: #628c2d;
    }

    .skin-green .pb-container {
        border-color: #666;
        border-left-color: #628c2d;
    }

    .skin-green .pb-text {
        color: black;
    }
    /* blue */

    .skin-blue .pb-wrapper {
        border-color: #0e7c78;
        border-top-color: #41beb9;
    }

    .skin-blue .pb-container {
        border-color: #0e7c78;
        border-left-color: #41beb9;
    }

    .skin-blue .pb-text {
        color: white;
    }

    .skin-blue .pb-value {
        background: #159b96;
    }
    /* red */

    .skin-red .pb-wrapper {
        border-color: #8e1411;
        border-top-color: #cb3d3a;
    }

    .skin-red .pb-container {
        border-color: #8e1411;
        border-left-color: #cb3d3a;
    }

    .skin-red .pb-text {
        color: #470200;
    }

    .skin-red .pb-value {
        background: #d70500;
    }
    /* orange */

    .skin-orange .pb-wrapper, .skin-orange .pb-container {
        border-color: #d55110;
    }

    .skin-orange .pb-text {
        color: #250f00;
    }

    .skin-orange .pb-value {
        background: #d75a00;
    }
    /* purple */

    .skin-purple .pb-wrapper, .skin-purple .pb-container {
        border-color: #a90561;
    }

    .skin-purple .pb-text {
        color: #720040;
    }

    .skin-purple .pb-value {
        background: #9d118e;
    }
    /* black */

    .skin-black .pb-wrapper, .skin-black .pb-container {
        border-color: black;
    }

    .skin-black .pb-text {
        color: gray;
    }

    .skin-black .pb-value {
        background: #111111;
    }
    /* 分割线样式 */

    .hua-li-de-fen-ge-xian {
        border-bottom: 2px dashed #eee;
        height: 1px;
        font-size: 1px;
        margin: 5px 0;
    }
    /*.pb-value{height:100%;width:50%;background:#19d73d;}*/
</style>
<script>
    window.onload = function () {
        loadTwo();
        gridList();
    }
    function loadTwo() {
        var ListMonth = new Array();
        var ListDeliveryRate = new Array();

        $.ajax({
            async: false,
            url: "/OperationMonitoring/BusinessOverview/GetDataDeliveryCompletionRate",
            type: "get",
            dataType: "json",
            success: function (da) {
                $(da).each(function (index, item) {
                    ListMonth.push(item.Month);
                    ListDeliveryRate.push(item.DeliveryRate);
                })
            }
        })
        var myChart = echarts.init(document.getElementById('chart2'));
        var colors = ['#5793f3', '#d14a61', '#675bba'];

        var option = {
            color: colors,
            tooltip: {
                trigger: 'none',
                axisPointer: {
                    type: 'cross'
                }
            },
            grid: {
                top: 10,
                bottom: 30
            },
            xAxis: [
                {
                    type: 'category',
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLine: {
                        onZero: false,
                        lineStyle: {
                            color: colors[1]
                        }
                    },
                    axisPointer: {
                        label: {
                            formatter: function (params) {
                                return '交期达成率  ' + params.value + (params.seriesData.length ? '：' + params.seriesData[0].data : '') + '%';
                            }
                        }
                    },
                    data: ListMonth//['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12']
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    axisLabel: {
                        show: true,
                        interval: 'auto',
                        formatter: '{value} %'
                    },
                    show: true
                }
            ],
            series: [
                {
                    name: '交期达成率',
                    type: 'line',
                    smooth: true,
                    data: ListDeliveryRate,//[80, 76, 86, 96, 92, 99, 88, 90, 95, 80, 95, 88],
                    // 显示数值
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                formatter: '{c}%',
                                position: 'bottom',
                                color: "#505050"
                            }
                        }
                    }
                }
            ]
        };
        myChart.setOption(option);
    }
    function gridList() {
        var $gridList = $("#gridList");
        $gridList.dataGrid({
            url: "/OperationMonitoring/BusinessOverview/GetGridJson",
            height: 300,
            colModel: [
                { label: '模具编号', name: 'MoldNo', width: 150, align: 'left' },
                { label: '试模', name: 'MoldTest', width: 150, align: 'left' },
                { label: '类型', name: 'Type', width: 150, align: 'left' },
                { label: '状态', name: 'State', width: 150, align: 'left' },
                { label: '产品名称', name: 'ProductName', width: 150, align: 'left' },
                {
                    label: '计划交期', name: 'PlannedDeliveryDate', width: 150, align: 'left',
                    formatter: "date", formatoptions: { srcformat: 'Y/m/d', newformat: 'Y/m/d' }
                },
                {
                    label: '预警', name: 'EarlyWarning', width: 120, align: 'left',
                    formatter: function (cellvalue, row, index) {
                        return '<div class="process-bar skin-green"><div class="pb-wrapper"><div class="pb-highlight"></div><div class="pb-container"><div class="pb-text">' + index.EarlyWarning + '%</div><div class="pb-value" style="height:100%;width:' + index.EarlyWarning + '%;background:#19d73d;"></div></div></div></div> '
                    }
                },
            ],
            pager: "#gridPager",
            sortname: 'MoldNo desc',
            viewrecords: true
        });
    }
</script>
<body>
    <div class="row">
        <section class="col-lg-6 connectedSortable" style="width:100%">
            <div class="">
                <div class="box-header with-border">
                    <h4 class="box-title">交付率/进度</h4>
                </div>
                <div class="tab-content" style="height:100%;">
                    <div style="height:200px">
                        <div style="text-align:center;font-size:13px;">交期达成率趋势</div>
                        <div id="chart2" style="height:250px;"></div>
                    </div>
                    <div class="gridPanel" style="margin:120px;">
                        <div style="text-align:center;font-size:13px;">在制模具进度</div>
                        <table id="gridList"></table>
                        <div id="gridPager"></div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>