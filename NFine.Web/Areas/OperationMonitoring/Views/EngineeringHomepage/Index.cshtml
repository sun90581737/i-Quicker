@{
    ViewBag.Title = "工程主页";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml"; //"~/Views/Shared/_Index.cshtml";
}
<script src="~/Content/js/echarts/4.3/echarts.js"></script>
<script src="~/Content/js/bootstrap/bootstrap.js"></script>
<link href="~/Content/js/bootstrap/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/js/pages/AdminLTE.css" rel="stylesheet" />
@*<link href="~/Content/js/pages/AdminLTE.min.css" rel="stylesheet" />*@
<link href="~/Content/js/pages/app.css" rel="stylesheet" />
<style>
</style>
<script>
    window.onload = function () {
        loadOneA();
        loadTwoA();
        loadTwoB();
        loadThreeA();
        gridList();
        $('#layout').layout();
        treeView();
        gridListOn();
    }
    function loadOneA() {
        $.ajax({
            async: false,
            url: "/OperationMonitoring/EngineeringHomepage/GetDataUserEngineeringList",
            type: "get",
            dataType: "json",
            success: function (da) {
                var item = da[0];
                $("#a1").text(item.RealName);
                $("#b1").text(item.CustomerAmount);
                $("#b1").css({ "color": item.CustomerAmountColor });
                $("#c1").text(item.DeliveryCompletionRate + "%");
                $("#c1").css({ "color": item.DeliveryCompletionRateColor });
                $("#d1").text(item.OnTimeDeliveryMold);
                $("#d1").css({ "color": item.OnTimeDeliveryMoldColor });
                $("#e1").text(item.LateDeliveryMold);
                $("#e1").css({ "color": item.LateDeliveryMoldColor });
                $("#f1").text(item.MoldInProcess);
                $("#f1").css({ "color": item.MoldInProcessColor });
                $("#g1").text(item.NormalProgress);
                $("#g1").css({ "color": item.NormalProgressColor });
                $("#h1").text(item.ScheduleDelay);
                $("#h1").css({ "color": item.ScheduleDelayColor });
            }
        })
    }
    function loadTwoA() {
        var ListMonth = new Array();
        var ListDeliveryRate = new Array();

        $.ajax({
            async: false,
            url: "/OperationMonitoring/EngineeringHomepage/GetDataEHDeliveryCompletionRate",
            type: "get",
            dataType: "json",
            success: function (da) {
                $(da).each(function (index, item) {
                    ListMonth.push(item.Month);
                    ListDeliveryRate.push(item.DeliveryRate);
                })
            }
        })
        var myChart = echarts.init(document.getElementById('chart1'));
        var option = {
            title: {
                text: ''
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                top: 10,
                left: 40,
                right: 15,
                bottom: 50,
                containLabel: false
            },
            //toolbox: {
            //    feature: {
            //        saveAsImage: {}
            //    }
            //},
            tooltip: {
                trigger: 'axis',
                formatter: function (params) {
                    var relVal = params[0].name;
                    for (var i = 0, l = params.length; i < l; i++) {
                        relVal += '<br/>' + params[i].marker + params[i].seriesName + ' : ' + params[i].value + "%";
                    }
                    return relVal;
                }
            },
            xAxis: [{
                type: 'category',
                data: ListMonth,
                axisLine: {
                    show: false,
                    lineStyle: {
                        color: '#0be3fb',

                    }
                },
                axisLabel: {
                    // interval: 0,
                    // rotate: 40,
                    textStyle: {
                        fontSize: '11'
                    }
                },
                axisTick: { //y轴刻度线
                    show: false
                },
            }],
            yAxis: [{
                interval: 20,
                type: 'value',
                axisLine: {
                    show: false,
                    lineStyle: {
                        color: '#0be3fb'
                    }
                },
                splitLine: {
                    show: false,
                    lineStyle: {
                        color: "#57617B"
                    }
                },
                axisTick: { //y轴刻度线
                    show: false
                },
                axisLabel: {
                    formatter: function (value) {
                        return value + "%";
                    },
                    show: true,
                    textStyle: {
                        color: '#0be3fb'
                    }
                },
            }],
            series: [
                {
                    name: '交期达成率',
                    type: 'line',
                    areaStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(
                                    0, 0, 0, 1,
                                    [
                                        { offset: 0, color: '#34d0e9' },
                                        { offset: 0.5, color: '#0a3d70' },
                                        { offset: 1, color: 'transparent' }
                                    ]
                            )
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: '#00ffff', //改变折线点的颜色
                            lineStyle: {
                                color: '#00ffff' //改变折线颜色
                            }
                        }
                    },
                    data: ListDeliveryRate,
                }
            ]
        };
        myChart.setOption(option);
    }
    function loadTwoB() {
        var listName = new Array();
        var str = [];
        $.ajax({
            async: false,
            url: "/OperationMonitoring/EngineeringHomepage/GetDataEHNumberMoldsDelivered",
            type: "get",
            dataType: "json",
            success: function (da) {
                $(da).each(function (index, item) {
                    listName.push(item.Type);
                    var str3 = new Object();
                    str3.name = item.Type;
                    str3.value = item.Number;
                    str[index] = str3;
                })
            }
        })
        var myChart = echarts.init(document.getElementById('chart2b'))

        var color = ['#2F8DF4', '#FC4567', '#C25EC4']

        var option = {
            color: color,
            title: {
                text: '',
                left: 'center',
                top: '50%',
                textStyle: {
                    fontSize: 22,
                    color: '#fff',
                    fontWeight: 'normal'
                }
            },
            tooltip: {
                trigger: 'item'
            },
            legend: {
                //orient: 'vertical',
                //right: 20,
                //top: 20,
                itemWidth: 10,  //图例标记的图形宽度
                itemHeight: 10, //图例标记的图形高度
                bottom: 0,
                left: 'center',
                data: listName,
                textStyle: {    //图例文字的样式
                    color: '#ffffff',  //文字颜色
                    fontSize: 12    //文字大小
                }
            },
            series: [{
                type: 'pie',
                roseType: 'radius',
                radius: ['40%', '70%'],
                center: ['48%', '50%'],
                data: str,
                label: {
                    normal: {
                        formatter: '{font|{c}}\n{hr|}\n{font|{d}%}',
                        rich: {
                            font: {
                                fontSize: 14,
                                padding: [5, 0],
                                color: '#fff'
                            },
                            hr: {
                                height: 0,
                                borderWidth: 1,
                                width: '100%',
                                borderColor: '#fff'
                            }
                        }
                    },
                },
                labelLine: {
                    lineStyle: {
                        color: '#fff'
                    }
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0,0,0,0.5)'
                    }
                }
            }]
        };
        myChart.setOption(option);
    }
    function loadThreeA() {
        var listName = new Array();
        var str = [];

        $.ajax({
            async: false,
            url: "/OperationMonitoring/EngineeringHomepage/GetDataEHProductionSchedule",
            type: "get",
            dataType: "json",
            success: function (da) {
                $(da).each(function (index, item) {
                    listName.push(item.Name);
                    var str3 = new Object();
                    str3.name = item.Name;
                    str3.value = item.Number;
                    str[index] = str3;
                })
            }
        })

        var myChart = echarts.init(document.getElementById('chart2a'));
        var option = {
            //title: {
            //    text: '某站点用户访问来源',
            //    subtext: '纯属虚构',
            //    left: 'center'
            //},
            tooltip: {
                trigger: 'item',
                formatter: "{b} : ({c}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                itemWidth: 10,  //图例标记的图形宽度
                itemHeight: 10, //图例标记的图形高度
                data: listName//['CNC', 'EDM', 'WEDM', '车铣磨抛']
            },
            color: ['#FFFF99', '#CCCC66', '#00CC99', '#FF3333'],
            series: [
                {
                    name: '访问来源',
                    type: 'pie',
                    radius: '65%',
                    center: ['50%', '50%'],
                    data: str//[{ value: 23, name: 'CNC' },{ value: 26, name: 'EDM' },{ value: 17, name: 'WEDM' },{ value: 34, name: '车铣磨抛' },]
                    ,
                    itemStyle: {  //图形样式
                        normal: { //normal 是图形在默认状态下的样式；emphasis 是图形在高亮状态下的样式，比如在鼠标悬浮或者图例联动高亮时。
                            label: {  //饼图图形上的文本标签
                                show: true,  //平常不显示
                                formatter: '{c}%',
                                position: 'inner'
                            },
                            labelLine: {     //标签的视觉引导线样式
                                show: false  //平常不显示
                            }
                        },
                        emphasis: {   //normal 是图形在默认状态下的样式；emphasis 是图形在高亮状态下的样式，比如在鼠标悬浮或者图例联动高亮时。
                            label: {  //饼图图形上的文本标签
                                show: true,
                                position: 'center',
                                textStyle: {
                                    fontSize: '20',
                                    fontWeight: 'bold'
                                }
                            },
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                }
            ]
        };
        myChart.setOption(option);
    }
    function gridList() {
        var $gridList = $("#gridList");
        $gridList.dataGrid({
            url: "/OperationMonitoring/EngineeringHomepage/GetGridJson",
            height: 187,
            colModel: [
                { label: '模具编号', name: 'MoldNo', width: 80, align: 'left' },
                { label: '客户', name: 'Customers', width: 60, align: 'left' },
                { label: '类型', name: 'Type', width: 60, align: 'left' },
                {
                    label: '计划交期', name: 'PlannedDeliveryDate', width: 80, align: 'left',
                    formatter: "date", formatoptions: { srcformat: 'Y/m/d', newformat: 'Y/m/d' }
                },
                {
                    label: '预警', name: 'EarlyWarning', width: 90, align: 'left',
                    formatter: function (cellvalue, row, index) {
                        return '<div style="top: 10%;left: 40%; transform: translate(-10%, -40%);"> <div style="border: 1px #000000 solid;margin:0 auto;position: relative;width:80%; height: 5px;background-color: #f9e1e3; border-radius: 3px;"><div style="white-space: pre-line;width: ' + index.EarlyWarning + '%;height: 100%;background-color:' + index.EarlyWarningColor + ';border-radius: 3px;"></div></div></div>'
                    }
                },
            ],
            //pager: "#gridPager",
            sortname: 'MoldNo desc',
            viewrecords: true
        });
    }
    function treeView() {
        $("#itemTree").treeview({
            url: "/OperationMonitoring/EngineeringHomepage/GetTreeJson",
            onnodeclick: function (item) {
                //$("#txt_keyword").val('');
                $('#btn_hidden').trigger("click");
            }
        });

        $("#btn_search").click(function () {
            $("#itemTree").treeview({
                url: "/OperationMonitoring/EngineeringHomepage/GetTreeDetailJson?value=" + $("#txt_keyword").val(),
                onnodeclick: function (item) {
                    $('#btn_hidden').trigger("click");
                }
            });
        });
    }
    function gridListOn() {
        var $gridListOn = $("#gridListOn");
        $gridListOn.dataGrid({
            height: 165,
            colModel: [
                {
                    label: '', name: '', width: 30, align: 'left',
                    formatter: function (cellvalue, row, index) {
                        if (index.Colour != "") {
                            return '<span style="padding:1px 8px;border-radius:50%;background:' + index.Colour + ';"></span>'
                        }
                    }
                },
                { label: '模具名称', name: 'MoldName', width: 120, align: 'left' },
                { label: '模具编号', name: 'MoldNo', width: 120, align: 'left' },
                { label: 'TN', name: 'TN', width: 60, align: 'left' },
                { label: '类型', name: 'MoldType', width: 60, align: 'left' },
                { label: '状态', name: 'MoldState', width: 100, align: 'left' },
                { label: '优先级', name: 'Priority', width: 80, align: 'left' },
                {
                    label: '试模日期', name: 'MoldDate', width: 120, align: 'left',
                    formatter: "date", formatoptions: { srcformat: 'Y-m-d', newformat: 'Y-m-d' }
                },
                { label: '试模厂', name: 'MoldFactory', width: 80, align: 'left' },
                { label: '模仁材质', name: 'MoldMaterial', width: 80, align: 'left' },
                { label: '类别', name: 'Category', width: 80, align: 'left', sortable: false }
            ]
        });
        $("#btn_hidden").click(function () {
            $gridListOn.jqGrid('setGridParam', {
                url: "/OperationMonitoring/EngineeringHomepage/GetDetailGridJson",
                postData: { itemId: $("#itemTree").getCurrentNode().id},
            }).trigger('reloadGrid');
        });
    }
    function funOne() {
        window.open("/OperationMonitoring/EngineeringHomepage/Form1");
    }
    function funTwo() {
        window.open("/OperationMonitoring/EngineeringHomepage/Form2");
    }
    function funThree() {
        window.open("/OperationMonitoring/EngineeringHomepage/Form3");
    }
</script>
<body>
    <div class="row">
        <div>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 30px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">项目工程师/人</h6>
                        <h6 id="a1" style="text-align:center;font-weight:bold;font-size:17px;color:#00CC99"></h6>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">负责客户数量/人</h6>
                        <h6 id="b1" style="text-align:center;font-weight:bold;font-size:17px;"></h6>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">交期达成率/月</h6>
                        <h6 id="c1" style="text-align:center;font-weight:bold;font-size:17px;"></h6>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">按期交付模具/月</h6>
                        <h6 id="d1" style="text-align:center;font-weight:bold;font-size:17px;"></h6>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">延期交付模具/月</h6>
                        <h6 id="e1" style="text-align:center;font-weight:bold;font-size:17px;"></h6>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">在制模具/个</h6>
                        <h6 id="f1" style="text-align:center;font-weight:bold;font-size:17px;"></h6>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">进度正常/个</h6>
                        <h6 id="g1" style="text-align:center;font-weight:bold;font-size:17px;"></h6>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:12%;background: url('../../../../Content/js/pages/img/gcbj.png') 0 0 / 100% 100% no-repeat;background-size:150px 80px;margin : 10px 2px 0px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h6 style="text-align:center;font-size:10px;color:#fff">进度延误/个</h6>
                        <h6 id="h1" style="text-align:center;font-weight:bold;font-size:17px;"></h6>
                    </div>
                </div>
            </section>
        </div>
        <div>
            <section class="col-lg-6 connectedSortable" style="width:48%;background: url('../../../../Content/js/pages/img/BusinessOverview01.png') 0 0 / 100% 100% no-repeat;position: relative;  margin : 0px 5px 5px 25px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <div class="box-title" style="color:#ffffff;font-size:16px;font-weight:700;">交期达成率<img src="../../../../Content/js/pages/img/head.png" style="width:325px;height:12px;position: relative;margin-top:-1px;background: url('../../../../Content/js/pages/img/head.png') 0 0 / 100% 100% no-repeat;" /></div>
                        @*<div class="box-tools pull-right">
                            <button type="button" onclick="funOne()" class="btn btn-box-tool"><i class="fa fa-expand"></i></button>
                        </div>*@
                    </div>
                    <div class="tab-content" style="height:240px;">
                        <div style="float:left;width:40%">
                            <div style="text-align:center;font-size:13px;color:#ffffff;">上月交付模具数量</div>
                            <div id="chart2b" style="height:200px;"></div>
                        </div>
                        <div style="margin-left:40%;">
                            <div style="text-align:center;font-size:13px;color:#ffffff;">交期达成率趋势</div>
                            <div id="chart1" style="height:240px;width:450px;"></div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="col-lg-6 connectedSortable" style="width:48%;background: url('../../../../Content/js/pages/img/BusinessOverview01.png') 0 0 / 100% 100% no-repeat;position: relative;  margin : 0px 5px 5px 0px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <div class="box-title" style="color:#ffffff;font-size:16px;font-weight:700;">在制进度正常、延误比例<img src="../../../../Content/js/pages/img/head.png" style="width:325px;height:12px;position: relative;margin-top:-1px;background: url('../../../../Content/js/pages/img/head.png') 0 0 / 100% 100% no-repeat;" /></div>
                        @*<div class="box-tools pull-right">
                            <button type="button" onclick="funTwo()" class="btn btn-box-tool"><i class="fa fa-expand"></i></button>
                        </div>*@
                    </div>
                    <div class="tab-content" style="height:240px;">
                        <div style="float:left;width:35%">
                            <div style="text-align:center;font-size:13px;color:#ffffff;">生产进度</div>
                            <div id="chart2a" style="height:220px; "></div>
                        </div>
                        <div class="gridPanel" style="margin-left:35%;">
                            <div style="text-align:center;font-size:13px;color:#ffffff;">延期模具列表</div>
                            <table id="gridList"></table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <div>
            <section class="col-lg-6 connectedSortable" style="width:97%;background: url('../../../../Content/js/pages/img/BusinessOverview01.png') 0 0 / 100% 100% no-repeat;position: relative;  margin : 0px 20px 0px 20px;">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <div class="box-title" style="color:#ffffff;font-size:16px;font-weight:700;">客户清单<img src="../../../../Content/js/pages/img/head.png" style="width:325px;height:12px;position: relative;margin-top:-1px;background: url('../../../../Content/js/pages/img/head.png') 0 0 / 100% 100% no-repeat;" /></div>
                        @*<div class="box-tools pull-right">
                            <button type="button" onclick="funThree()" class="btn btn-box-tool"><i class="fa fa-expand"></i></button>
                        </div>*@
                    </div>
                    <div class="ui-layout" id="layout" style="height: 215px; ">
                        <div class="ui-layout-west">
                            <div class="search">
                                <table>
                                    <tr>
                                        <td>
                                            <div class="input-group">
                                                <input id="txt_keyword" type="text" class="form-control" placeholder="搜索" style="width: 138px;box-shadow: none;height: 29px;line-height: 29px;padding-top: 0px;padding-bottom: 0px;padding-right: 0px;padding-left: 7px;resize: none;">
                                                <span class="input-group-btn">
                                                    <button id="btn_search" type="button" class="btn  btn-primary" style="padding: 0px 0px;font-size: 14px;height: 29px;min-width: 29px;"><i class="fa fa-search"></i></button>
                                                    <button id="btn_hidden" type="button" style="visibility: hidden;"></button>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="itemTree"></div>
                        </div>
                        <div class="ui-layout-center" >
                            <div class="gridPanel">
                                <table id="gridListOn"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</body>